<div>
  <!--<h2 translate>search</h2>-->
  <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>

  <obiba-alert id="SearchController"></obiba-alert>

  <!-- Nav tabs -->
  <ul class="nav nav-tabs" role="tablist" ng-if="tabs && tabs.length>1">
    <li ng-repeat="tab in tabs" role="presentation" ng-class="{ active: tab === lang }"><a href role="tab"
      ng-click="setLocale(tab)">{{'language.' + tab | translate}}</a></li>
  </ul>

  <!-- Classifications region -->
  <div class="{{tabs && tabs.length>1 ? 'tab-content voffset4' : ''}}">
    <!--<div>-->
    <div class="row">
      <div class="col-md-3"></div>
      <div class="col-md-6">
        <script type="text/ng-template" id="customTemplate.html">
          <a ng-if="match.model.id">
            <span title="{{match.model.target + '-classifications' | translate}}">
              <i class="{{'i-obiba-' + match.model.target}}"></i>
            </span>
            <span
              uib-popover-html="match.model.itemDescription | uibTypeaheadHighlight:query"
              popover-title="{{match.model.itemTitle}}"
              popover-placement="bottom"
              popover-trigger="mouseenter"
              ng-bind-html="match.model.itemTitle | uibTypeaheadHighlight:query">
            </span>
            <small class="help-block no-margin hoffset3" title="{{match.model.itemParentDescription}}">
              {{match.model.itemParentTitle}}
            </small>
          </a>
          <a ng-if="!match.model.id" class="{{match.model.status}}">
            <small class="help-block no-margin">
              {{match.model.message}}
            </small>
          </a>
        </script>

        <span class="input-group input-group-sm no-padding-top">
          <span class="input-group-btn" uib-dropdown>
          <button type="button" class="btn btn-primary" uib-dropdown-toggle>
            {{'taxonomy.target.' + documents.search.target | translate}} <span class="caret"></span>
          </button>
          <ul uib-dropdown-menu role="menu">
            <li ng-repeat="target in QUERY_TARGETS" role="menuitem"><a href ng-click="selectSearchTarget(target)">{{'taxonomy.target.' + target | translate}}</a></li>
          </ul>
        </span>
          <input type="text" ng-model="selectedCriteria" placeholder="{{'search.placeholder.' + documents.search.target | translate}}"
            uib-typeahead="criteria for criteria in searchCriteria($viewValue)"
            typeahead-min-length="2"
            typeahead-loading="documents.search.active"
            typeahead-template-url="customTemplate.html"
            typeahead-on-select="selectCriteria($item)"
            class="form-control">
          <span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>
        </span>
      </div>
    </div>
    <div class="row">
      <div class="col-md-3"></div>
      <div class="col-md-6">
        <ul class="nav nav-pills">
          <li ng-repeat="t in taxonomyNav" title="{{t.locale.description.text}}">
            <a href ng-click="showTaxonomy(t.target, t.name)" ng-if="!t.terms">{{t.locale.title.text}}</a>
            <span uib-dropdown ng-if="t.terms">
              <ul class="nav nav-pills">
                <li>
                  <a href uib-dropdown-toggle>{{t.locale.title.text}} <span class="caret"></span></a>
                </li>
              </ul>
              <ul uib-dropdown-menu>
                <li ng-repeat="st in t.terms">
                  <a href ng-click="showTaxonomy(t.target, st.name)" title="{{st.locale.description.text}}">{{st.locale.title.text}}</a>
                </li>
              </ul>
            </span>
          </li>
        </ul>
      </div>
    </div>
    <taxonomies-panel taxonomy-name="taxonomyName" target="target" on-select-term="onSelectTerm" on-close="clearTaxonomy" lang="lang"></taxonomies-panel>
  </div>

  <!-- Search criteria region -->
  <div class="row">
    <div class="col-md-12">
      <div criteria-root item="search.criteria" query="search.query" on-remove="removeCriteriaItem"
        on-refresh="refreshQuery"></div>
    </div>
  </div>

  <!-- Results region -->
  <div class="voffset3" ng-if="search.query">
    <result-panel display="search.display"
      type="search.type"
      bucket="search.bucket"
      query="search.executedQuery"
      result="search.result"
      loading="search.loading"
      on-update-criteria="onUpdateCriteria"
      on-type-changed="onTypeChanged"
      on-bucket-changed="onBucketChanged"
      on-paginate="onPaginate"
      search-tabs-order="searchTabsOrder"
      result-tabs-order="resultTabsOrder"
      lang="lang"></result-panel>
  </div>
</div>