<!--
  ~ Copyright (c) 2014 OBiBa. All rights reserved.
  ~
  ~ This program and the accompanying materials
  ~ are made available under the terms of the GNU Public License v3.0.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->

<div>

  <h2>
    <ol class="mica-breadcrumb">
      <li><a href="/#/harmonization-dataset" translate>harmonization-datasets</a></li>
      <li class="active">{{dataset.id}}</li>
    </ol>
  </h2>

  <div class="clearfix">
    <div class="pull-left">
      <small class="help-block inline">{{'global.lastUpdate' | translate}}: {{dataset.timestamps.lastUpdate ===
        undefined ? dataset.timestamps.created : dataset.timestamps.lastUpdate |
        amDateFormat : 'lll'}}
      </small>
      <i class="fa fa-star-o" ng-show="!dataset.published"
        title="{{'publish.not-published' | translate}}"></i>
      <i class="fa fa-star" ng-show="dataset.published"
        title="{{'publish.published' | translate}}"></i>
    </div>
    <div class="btn-group pull-right">
      <a ng-href="#/harmonization-dataset/{{dataset.id}}/edit" class="btn btn-primary"
        ng-if="hasRole(['mica-administrator','mica-reviewer','mica-editor'])">
        <i class="fa fa-pencil-square-o"></i> <span translate>edit</span>
      </a>
      <publish-switch status="isPublished()" publish="publish()"
        ng-if="hasRole(['mica-administrator','mica-reviewer'])"></publish-switch>
    </div>
  </div>


  <tabset>
    <tab ng-repeat="tab in tabs" heading="{{'language.' + tab.lang | translate}}" active="tab.active"
      disabled="tab.disabled">

      <div class="row">
        <div class="col-md-6">
          <h3 translate>dataset.general-info</h3>
          <table class="table table-bordered table-striped">
            <tbody>
            <tr>
              <th translate>dataset.name</th>
              <td>
                <localized value="dataset.name" lang="tab.lang"></localized>
              </td>
            </tr>
            <tr>
              <th translate>dataset.acronym</th>
              <td>
                <localized value="dataset.acronym" lang="tab.lang"></localized>
              </td>
            </tr>
            <tr>
              <th translate>dataset.description</th>
              <td>
                <localized value="dataset.description" lang="tab.lang"></localized>
              </td>
            </tr>
            <tr>
              <th translate>dataset.entity-type</th>
              <td>{{dataset.entityType}}</td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="col-md-6">
          <h3 translate ng-show="dataset['obiba.mica.HarmonizationDatasetDto.type']">dataset.data-schema.title</h3>
          <table class="table table-bordered table-striped">
            <tbody>
            <tr>
              <th translate>dataset.project</th>
              <td>
                <a ng-href="{{opal + '/ui/index.html#!project;name=' + datasetProject}}" target="_blank">{{datasetProject}}</a>
              </td>
            </tr>
            <tr>
              <th translate>dataset.table</th>
              <td>
                <a
                  ng-href="{{opal + '/ui/index.html#!project;name=' + datasetProject + ';tab=TABLES;path=' + datasetProject + '.' + datasetTable}}"
                  target="_blank">{{datasetTable}}</a>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>

      <h3 translate ng-show="dataset['obiba.mica.HarmonizationDatasetDto.type']">dataset.study-tables.title</h3>
      <table class="table table-bordered table-striped" ng-show="dataset['obiba.mica.HarmonizationDatasetDto.type']">
        <thead>
        <tr>
          <th translate>study.label</th>
          <th translate>study.population</th>
          <th translate>study.data-collection-event</th>
          <th translate>dataset.project</th>
          <th translate>dataset.table</th>
          <th translate>dataset.table-name</th>
          <th translate>dataset.table-description</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="studyTable in dataset['obiba.mica.HarmonizationDatasetDto.type'].studyTables">
          <td>
            <a ng-href="#/study/{{studyTable.studyId}}">
              {{studyTable.studyId}}
            </a>
          </td>
          <td>
            {{studyTable.populationId}}
          </td>
          <td>
            {{studyTable.dataCollectionEventId}}
          </td>
          <td>
            {{studyTable.project}}
          </td>
          <td>
            {{studyTable.table}}
          </td>
          <td>
            <localized value="studyTable.name" lang="tab.lang"></localized>
          </td>
          <td>
            <localized value="studyTable.description" lang="tab.lang"></localized>
          </td>
        </tr>
        </tbody>
      </table>

    </tab>
  </tabset>


</div>
